<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Our Little World</title>

    <style>
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        body {
            margin: 0;
            height: 100vh;
            background: radial-gradient(circle at top, #1a0f1f, #050507);
            font-family: -apple-system, BlinkMacSystemFont, sans-serif;
            color: white;
            overflow: hidden;
        }

        /* ---------- STAGES ---------- */
        .stage {
            display: none;
            position: absolute;
            inset: 0;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            text-align: center;
        }

        .stage.active {
            display: flex;
            animation: fadeIn 1s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        /* ---------- FADE OUT ---------- */
        .fade-out {
            animation: fadeOut 4s forwards;
        }

        @keyframes fadeOut {
            to { opacity: 0; }
        }

        /* ---------- LOADING ---------- */
        .city { position: absolute; font-size: 1.2rem; }
        #delhi { left: 15%; top: 50%; }
        #mumbai { right: 15%; top: 50%; }

        .path {
            position: absolute;
            top: 53%;
            left: 18%;
            width: 64%;
            height: 2px;
            background: linear-gradient(90deg, transparent, #ff6b81, transparent);
        }

        .heart {
            position: absolute;
            top: 47%;
            left: 18%;
            font-size: 26px;
            animation: travel 3s ease-in-out forwards;
        }

        @keyframes travel {
            0% { left: 18%; }
            100% { left: 82%; }
        }

        /* ---------- LOVE ---------- */
        #tapHeart { font-size: 90px; cursor: pointer; }

        .meter {
            width: 240px;
            height: 16px;
            background: #222;
            border-radius: 20px;
            overflow: hidden;
            margin-top: 20px;
        }

        .fill {
            height: 100%;
            width: 0%;
            background: linear-gradient(90deg,#ff4d4d,#ff9aa2);
            transition: width 0.3s;
        }

        /* ---------- SCRATCH ---------- */
        .card {
            width: 280px;
            height: 280px;
            position: relative;
            border-radius: 20px;
            overflow: hidden;
        }

        .card img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        canvas {
            position: absolute;
            inset: 0;
            touch-action: none;
        }

        /* ---------- TEXT ---------- */
        #revealText {
            margin-top: 20px;
            opacity: 0;
            transition: opacity 1.5s ease;
        }

        /* ---------- FINAL ---------- */
        #final {
            font-size: 2.2rem;
            letter-spacing: 2px;
            opacity: 0;
            transition: opacity 3s ease;
        }

        /* ---------- HEARTS ---------- */
        .heart-particle {
            position: fixed;
            pointer-events: none;
            font-size: 22px;
            animation: floatUp 1.8s ease-out forwards;
        }

        @keyframes floatUp {
            from { transform: translateY(0) scale(1); opacity: 1; }
            to { transform: translateY(-120px) scale(0); opacity: 0; }
        }
    </style>
</head>

<body>

<!-- LOADING -->
<div id="loading" class="stage active">
    <div class="city" id="delhi">Delhi</div>
    <div class="city" id="mumbai">Mumbai</div>
    <div class="path"></div>
    <div class="heart">❤️</div>
</div>

<!-- LOVE -->
<div id="love" class="stage">
    <div>Tap slowly. I’m not in a hurry.</div>
    <div id="tapHeart">❤️</div>
    <div class="meter"><div id="fill" class="fill"></div></div>
</div>

<!-- SCRATCH -->
<div id="scratch" class="stage">
    <div class="card">
        <img src="abc.jpg">
        <canvas id="scratchCanvas"></canvas>
    </div>
    <div id="revealText">I love you, rishubaby.</div>
</div>

<!-- FINAL -->
<div id="final" class="stage">
    I love you.
</div>

<audio id="finalSong" src="a.webm"></audio>

<script>
    /* ---------- HELPERS ---------- */
    function show(id) {
        document.querySelectorAll('.stage').forEach(s => s.classList.remove('active'));
        document.getElementById(id).classList.add('active');
    }

    function spawnHeart(x, y) {
        const h = document.createElement('div');
        h.className = 'heart-particle';
        h.textContent = '❤️';
        h.style.left = x + 'px';
        h.style.top = y + 'px';
        document.body.appendChild(h);
        setTimeout(() => h.remove(), 1800);
    }

    function heartBurstOverCanvas(canvas) {
        const rect = canvas.getBoundingClientRect();
        for (let i = 0; i < 40; i++) {
            setTimeout(() => {
                spawnHeart(
                    rect.left + Math.random() * rect.width,
                    rect.top + Math.random() * rect.height
                );
            }, i * 60);
        }
    }

    /* ---------- FLOW ---------- */
    setTimeout(() => show('love'), 3200);

    /* ---------- LOVE ---------- */
    let love = 0;
    tapHeart.onclick = () => {
        love += 10;
        fill.style.width = love + '%';
        if (love >= 100) {
            setTimeout(() => {
                show('scratch');
                initScratch();
            }, 500);
        }
    };

    /* ---------- SCRATCH ---------- */
    let started = false;

    function initScratch() {
        if (started) return;
        started = true;

        const canvas = scratchCanvas;
        const ctx = canvas.getContext('2d');
        const text = revealText;
        const song = finalSong;
        const scratchStage = document.getElementById('scratch');

        canvas.width = 280;
        canvas.height = 280;
        ctx.fillStyle = '#333';
        ctx.fillRect(0, 0, 280, 280);

        let drawing = false;
        let revealed = false;

        function scratch(x, y) {
            ctx.globalCompositeOperation = 'destination-out';
            ctx.beginPath();
            ctx.arc(x, y, 28, 0, Math.PI * 2);
            ctx.fill();

            const rect = canvas.getBoundingClientRect();
            spawnHeart(rect.left + x, rect.top + y);

            checkReveal();
        }

        function checkReveal() {
            if (revealed) return;

            const data = ctx.getImageData(0, 0, 280, 280).data;
            let cleared = 0;
            for (let i = 3; i < data.length; i += 80)
                if (data[i] === 0) cleared++;

            if (cleared / (data.length / 80) > 0.6) {
                revealed = true;

                text.style.opacity = 1;
                song.play();
                heartBurstOverCanvas(canvas);
                autoWipe();
            }
        }

        function autoWipe() {
            let y = 0;
            const wipe = setInterval(() => {
                ctx.globalCompositeOperation = 'destination-out';
                ctx.fillRect(0, y, 280, 40);
                y += 40;

                if (y >= 280) {
                    clearInterval(wipe);
                    fadeToFinal();
                }
            }, 90);
        }

        function fadeToFinal() {
            setTimeout(() => {
                scratchStage.classList.add('fade-out');
                setTimeout(() => {
                    show('final');
                    final.style.opacity = 1;
                }, 4000);
            }, 2000);
        }

        canvas.onmousedown = e => { drawing = true; scratch(e.offsetX, e.offsetY); };
        canvas.onmouseup = () => drawing = false;
        canvas.onmousemove = e => drawing && scratch(e.offsetX, e.offsetY);

        canvas.ontouchstart = e => {
            drawing = true;
            const t = e.touches[0];
            const r = canvas.getBoundingClientRect();
            scratch(t.clientX - r.left, t.clientY - r.top);
        };

        canvas.ontouchmove = e => {
            e.preventDefault();
            const t = e.touches[0];
            const r = canvas.getBoundingClientRect();
            scratch(t.clientX - r.left, t.clientY - r.top);
        };

        canvas.ontouchend = () => drawing = false;
    }
</script>

</body>
</html>
